name: 'Lint Action'
description: 'Perform linting for project'
inputs:
  checkout_directory:
    description: "Directory where the repository content will be checked out."
    default: "src"
  ref:
    description: "Branch to checkout, by default It will take the short ref name of the branch or tag that triggered the workflow run."
    required: false
  token:
    description: "GitHub token used to fetch the source"
    required: false
  upload_to_artifactory:
    description: 'Flag to control whether to upload reports to Artifactory'
    required: false
    default: 'false'

permissions:
  contents: read
#Adding Permission as Read for all of the available permissions

runs:
  using: 'composite'
  steps:
    # - name: Checkout code
    #   uses: actions/checkout@v4
    #   with:
    #     path: ${{ inputs.checkout_directory }}
    #     ref: ${{ inputs.ref || github.ref }}
    #     token: ${{ inputs.token || github.token }}

    - name: Set up Python
      uses: actions/setup-python@v4

    - name: Install linting tools
      run: |
        python -m pip install --upgrade pip
        pip install flake8 pylint black isort
        pip install flake8-html pylint-report
      shell: bash

    - name: Run Flake8 Linting
      continue-on-error: true
      run: |
        mkdir -p reports/flake8
        flake8 --format=html --htmldir=reports/flake8 .
      shell: bash

    - name: Run Pylint
      continue-on-error: true
      run: |
        mkdir -p reports/pylint
        pylint **/*.py > reports/pylint/pylint-report.txt
      shell: bash

    - name: Run Isort Import Sorting Check
      continue-on-error: true
      run: |
        mkdir -p reports/isort
        isort --check-only . > reports/isort/import-check.txt
      shell: bash

    - name: Upload Linting Reports
      if: ${{ inputs.upload_to_artifactory == 'true' }}
      uses: actions/upload-artifact@v4
      with:
        name: linting-reports
        path: reports/